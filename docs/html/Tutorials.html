<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ECIQC: Tutorials</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ECIQC
   </div>
   <div id="projectbrief">The primary purpose of the tool is to automatically                           vaildate the DICOM images using for medical research.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md37">First Example</a><ul><li class="level3"><a href="#autotoc_md38">Example codes</a></li>
<li class="level3"><a href="#autotoc_md39">Explanation</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md40">Receiver, Destination and Quarantine</a></li>
<li class="level2"><a href="#autotoc_md41">MetaData</a><ul><li class="level3"><a href="#autotoc_md42">Basic syntax within DICOM tags</a></li>
<li class="level3"><a href="#autotoc_md43">Operation types</a><ul><li class="level4"><a href="#autotoc_md44">Comparison Operators ==,&lt;=,&gt;=,\in</a></li>
<li class="level4"><a href="#autotoc_md45">Regular expression EXIST REGEX</a></li>
<li class="level4"><a href="#autotoc_md46">Logical Operators NOT, AND, ALL</a></li>
<li class="level4"><a href="#autotoc_md47">Actions</a></li>
</ul>
</li>
<li class="level3"><a href="#autotoc_md48">Multiple operations</a><ul><li class="level4"><a href="#autotoc_md49">Repeated keys</a></li>
</ul>
</li>
<li class="level3"><a href="#autotoc_md50">Nested operations</a></li>
</ul>
</li>
</ul>
</ul>
</div>
<div class="textblock"><p>ECIQC is a flexible framework designed for medical imaging quality control. Users can guides its behaviour by crafting configuration files. In this tutorial, we will guide you through the process of specifying configuration files with increasing levels of detail. This tutorial caters to both non-developers (end-users) and developers who are new to this software. By the end of this tutorial, you will understand:</p><ul>
<li>General syntaxes of configuration files</li>
<li>How to modify example configuration files to meet users' requirements</li>
<li>How to start from strach to write proper configuration files</li>
</ul>
<p>Here are some common scenarios proposed by Chris from GE Healthcare. Corresponding configuration codes can be found on the configuration gallery page:</p><ul>
<li>Case 1: Check whether the patient name is a 6-digit number. If so, insert the patient name to clinical trial subject id; reject otherwise.</li>
<li>Case 2: Check whether the clinical trial protocol id is 3 letters followed by 6 digits. If so, prepend the patient name with "_" and clinical trial protocol id; reject otherwise.</li>
<li>Case 3: Check whether the date of birth is a 8-digit number. Replace the day with 30 and month with 06 if so.</li>
<li><p class="startli">Case 4: check whether the modality is 'MR'. If so, check whether the manufacturer is 'SIEMENS' or 'HITACHI'. If true, check whether the magnetic field strength equals 1.5 or 3.0. Set the clinical trial series description to T1 if all these conditions are satisfied; reject otherwise.</p>
<p class="startli">We recommend readers to go through this tutorial and the configuration gallery for a better understanding.If you have any questions, please refer to the FAQ page first. If the issue persists, feel free to email Yiming Wei(<a href="#" onclick="location.href='mai'+'lto:'+'yim'+'in'+'g.w'+'ei'+'@dt'+'c.'+'ox.'+'ac'+'.uk'; return false;">yimin<span style="display: none;">.nosp@m.</span>g.we<span style="display: none;">.nosp@m.</span>i@dtc<span style="display: none;">.nosp@m.</span>.ox.<span style="display: none;">.nosp@m.</span>ac.uk</a>) or Dr. Martin Robinson (<a href="#" onclick="location.href='mai'+'lto:'+'mar'+'ti'+'n.r'+'ob'+'ins'+'on'+'@dt'+'c.'+'ox.'+'ac'+'.uk'; return false;">marti<span style="display: none;">.nosp@m.</span>n.ro<span style="display: none;">.nosp@m.</span>binso<span style="display: none;">.nosp@m.</span>n@dt<span style="display: none;">.nosp@m.</span>c.ox.<span style="display: none;">.nosp@m.</span>ac.u<span style="display: none;">.nosp@m.</span>k</a>) for assistance.</p>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md37"></a>
First Example</h2>
<p>Configuration files are composed in JSON format. For guidance on initialising ECIQC, please refer to the main page. You can designate your custom configuration files by entering the following commands in the command line: </p><div class="fragment"><div class="line">./build/exe/qctool --config-file &lt;your_configuration_file.json&gt;</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md38"></a>
Example codes</h3>
<p>We illustrate the basic components with a simple configuration file. </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;receiver&quot;: {</div>
<div class="line">      &quot;aetitle&quot;: &quot;TestQCTool&quot;,</div>
<div class="line">      &quot;port&quot;: 11112</div>
<div class="line">    },</div>
<div class="line">    &quot;destination&quot;: {</div>
<div class="line">      &quot;aetitle&quot;: &quot;TestDestination&quot;,</div>
<div class="line">      &quot;hostname&quot;: &quot;localhost&quot;,</div>
<div class="line">      &quot;port&quot;: 11113</div>
<div class="line">    },</div>
<div class="line">    &quot;quarentine&quot;: {</div>
<div class="line">      &quot;aetitle&quot;: &quot;TestQuarentine&quot;,</div>
<div class="line">      &quot;hostname&quot;: &quot;localhost&quot;,</div>
<div class="line">      &quot;port&quot;: 11114</div>
<div class="line">    },</div>
<div class="line">    &quot;metadata&quot;: {</div>
<div class="line">        &quot;(0010,0010)&quot;: {</div>
<div class="line">          &quot;tagName&quot;: &quot;PatientName&quot;,</div>
<div class="line">          &quot;vr&quot;: &quot;CS&quot;,</div>
<div class="line">          &quot;description&quot;: &quot;check if patient is called &#39;bob&#39; and change, if so.&quot;,</div>
<div class="line">          &quot;operations&quot;: {</div>
<div class="line">            &quot;EQUAL_1234&quot;: {</div>
<div class="line">                &quot;otherTagString&quot;: &quot;&quot;,</div>
<div class="line">                &quot;value&quot;: &quot;John Doe&quot;,</div>
<div class="line">                &quot;IF_TRUE&quot;: {</div>
<div class="line">                    &quot;OVERWRITE&quot;: {</div>
<div class="line">                        &quot;tag&quot;: &quot;&quot;,</div>
<div class="line">                        &quot;replaceString&quot;: &quot;Robert&quot;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md39"></a>
Explanation</h3>
<p>The ECIQC receives medical images via <b>receiver</b> and sends post-processed images via <b>sender</b>.The key <code>receiver</code> specifies the port number so that another remote sender can identify it and send proper images. The ECIQC pipeline checks the image and send normal images to the <b>destination</b> and suspicious ones to the <b>quarantine</b>. <code>Destination</code> and <code>quarantine</code> tell the ECIQC their addresses.</p>
<p>The key <code>metadata</code> is the main component of the configuration file. You will see long lines of code within this part. Typically, you will see one or more DICOM tags to work on(0010,0010), accompanied by the tag name (Patient Name),vr (data type and format) and a short line of description. The key <code>operations</code> inform the ECIQC what to do with this tag. You can guess with your gut instinct that this configuration file requires the pipeline to replace the name with Robert if the patient name is John Doe.</p>
<h2><a class="anchor" id="autotoc_md40"></a>
Receiver, Destination and Quarantine</h2>
<p>As said before, <code>receiver</code> specifies the proper of the ECIQC receiver; <code>destination</code> tells the ECIQC where to send "good" images; <code>quarantine</code> provides the place to send "bad" images. You can use the local port for most test cases. However,if you are interested in communicating between different network nodes in real-world application (e.g. GE Healthcare), please ask your colleagues for more information.</p>
<h2><a class="anchor" id="autotoc_md41"></a>
MetaData</h2>
<p>The key <code>metadata</code> works on the metadata of a DICOM image.It usually comprises of one or more DICOM tags to work on. For full list of DICOM tags, please refer to the <a href="https://www.dicomlibrary.com/dicom/dicom-tags/">DICOM library</a>. </p>
<h3><a class="anchor" id="autotoc_md42"></a>
Basic syntax within DICOM tags</h3>
<p>Within each DICOM tag, you need to specify the <code>tagName</code>,<code>vr</code> and <code>description</code>. You can look up the <code>tagName</code> and <code>vr</code> in the <a href="https://www.dicomlibrary.com/dicom/dicom-tags/">DICOM library</a>. The <code>description</code> value is written by the user to enhace readibility. Then it comes to the key <code>operations</code>. </p>
<h3><a class="anchor" id="autotoc_md43"></a>
Operation types</h3>
<p>There are typicall four types of operators.</p><ol type="1">
<li>Comparison operators: EQUAL (==), GREATER_THAN, LESS_THAN,IS_IN. These operators compare the tag value with the ones provided by the user. They are usually followed by <code>IF_TRUE</code> and <code>IF_FALSE</code>.</li>
<li>regular expression operators: EXIST, REGEX. These two operations check whether thare are specific 'patterns' in the tag value 3.Logical Operators: NOT, AND, ALL. These are similar to those used in programming languages and typically link multiple comparison operations and regular expression operations.</li>
<li>Actions: OVERWRITE,REMOVE,INSERT,CLEAR,COPY,UPDATE,APPEND,PREPEND,REJECT. Those are the real actions to perform if certain conditions are satisfied. The users can specify unconditional actions, which is not recommended in most cases.</li>
</ol>
<p>We introduce the syntaxes of different operators in the following subsections. </p>
<h4><a class="anchor" id="autotoc_md44"></a>
Comparison Operators ==,&lt;=,&gt;=,\in</h4>
<p>The basic syntax of comparison operators is </p><div class="fragment"><div class="line">&quot;operations&quot;:{</div>
<div class="line">  &quot;&lt;comparison_operator&gt;&quot;:{</div>
<div class="line">    &quot;otherTagString&quot;:&quot;&lt;other_tag_string&gt;&quot;,</div>
<div class="line">    &quot;&lt;value_key&gt;&quot;:&lt;compared_value&gt;,</div>
<div class="line">    &quot;IF_TRUE&quot;:{&lt;action_clause&gt;},</div>
<div class="line">    &quot;IF_FALSE&quot;:{&lt;action_clause&gt;}</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p> where</p><ul>
<li>"&amp;lt;comparison_operator&amp;gt;": EQUAL, GREATER_THAN, LESS_THAN, IS_IN;</li>
<li>"&amp;lt;other_tag_string&amp;gt;": tag for comparison; If specified as an empty string, the system will use the root tag;</li>
<li>"&amp;lt;value_key&amp;gt;": There's a correspondence between &lt;comparison_operator&gt; and &lt;value_key&gt;. <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">&lt;comparison_operator&gt;   </th><th class="markdownTableHeadCenter">&lt;value_key&gt;    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">EQUAL   </td><td class="markdownTableBodyCenter">value    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">GREATER_THAN   </td><td class="markdownTableBodyCenter">compareValue    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">LESS_THAN   </td><td class="markdownTableBodyCenter">compareValue    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">IS_IN   </td><td class="markdownTableBodyCenter">valueList   </td></tr>
</table>
</li>
<li>&lt;action_clause&gt;: actions to take (also could be nested operations), please refer to actions section.</li>
</ul>
<h4><a class="anchor" id="autotoc_md45"></a>
Regular expression EXIST REGEX</h4>
<p>EXIST checks if the specified tag exists, while REGEX determines whether the tag value satisfies a regular expression pattern.</p>
<h4><a class="anchor" id="autotoc_md46"></a>
Logical Operators NOT, AND, ALL</h4>
<p>Logical operators usually combine different comparison operators or regular expression operators. One typical syntax is: </p><div class="fragment"><div class="line">&quot;operations&quot;:{</div>
<div class="line">  &quot;&lt;logical_operator&gt;&quot;:{</div>
<div class="line">      &quot;&lt;comparison_operator_1&gt;&quot;:{</div>
<div class="line">        &quot;otherTagString&quot;:&quot;&lt;other_tag_string_1&gt;&quot;,</div>
<div class="line">        &quot;&lt;value_key_1&gt;&quot;:&lt;compared_value_1&gt;,</div>
<div class="line">      },</div>
<div class="line">      &quot;&lt;comparison_operator_2&gt;&quot;:{</div>
<div class="line">        &quot;otherTagString&quot;:&quot;&lt;other_tag_string_2&gt;&quot;,</div>
<div class="line">        &quot;&lt;value_key_2&gt;&quot;:&lt;compared_value_2&gt;,</div>
<div class="line">      },</div>
<div class="line">      &quot;IF_TRUE&quot;:{&lt;action_clause&gt;},</div>
<div class="line">      &quot;IF_FALSE&quot;:{&lt;action_clause&gt;}</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p> Remark:</p><ul>
<li>&lt;logical_operator&gt;: <code>NOT</code>, <code>AND</code>, <code>OR</code>. <code>NOT</code> only permits one logical operator while <code>AND</code> and <code>OR</code> permits two or more.</li>
<li>If &lt;comparison_operator_1&gt; and &lt;comparison_operator_2&gt; are the same (e.g. EQUAL), use <code>EQUAL_1</code> and <code>EQUAL_2</code>,etc. </li>
</ul>
<h4><a class="anchor" id="autotoc_md47"></a>
Actions</h4>
<p>Actions might be the most complicated part in the configurations. A wide variety of actions are enabled in the ECIQC, and many requires further specifications. The actions can be divided into several groups as follows.</p><ul>
<li><b>Group 1</b>: UPDATE, INSERT, OVERWRITE UPDATE means adding something in the next value channel without removing current ones; INSERT means adding specified value if the tag doesn't exist. OVERWRITE replaces the value if the tag exists.</li>
<li><b>Group 2</b>: REMOVE, CLEAR REMOVE means eliminating both the tag and the value while CLEAR asks to "remove" the value (tag is perserved).</li>
<li><b>Group 3</b>: APPEND, PREPEND, APPEND means adding string at the end of the original value, while PREPEND means adding string at the start. Differetn from Group actions, the original tag value is presered in APPEND and PREPEND.</li>
<li><b>Group 4</b>: REJECT REJECT means putting the image to the quarantine.</li>
</ul>
<h3><a class="anchor" id="autotoc_md48"></a>
Multiple operations</h3>
<p>The users bump into multiple operations when multiple actions are needed. For example, you may want to prepend the patient name with a '_', and then copy the '_patient_name' to other tags. Also, users will naturally use multiple operations when logical operators are introduced. A typical instance is telling whether the tag value is in some range (AND, GREATER_THAN lower bound, LESS_THAN upper bound). The implementation of ECIQC naturally supports multiple operations as long as you put your desired order of actions correctly. However, you need to pay attention to the repeated keys issue. </p>
<h4><a class="anchor" id="autotoc_md49"></a>
Repeated keys</h4>
<p>A typical scenario for repeated keys is that you need to decide whether the tag value is <code>EQUAL</code> to valueA or valueB. One solution is to use the operation <code>IS_in</code> and specify the comparison value to be a list. A more general approach is to prepend the <code>EQUAL</code> key with an unscore followed by some digits (<code>EQUAL_1</code>,<code>EQUAL_2</code>,...etc). The ECIQC will recognize them as different keys but behave in the same way as <code>EQUAL</code>.</p>
<h3><a class="anchor" id="autotoc_md50"></a>
Nested operations</h3>
<p>The implementation of ECIQC also provides some flexibility for nested operations. A typical case would be: compare one tag to some value, and if the condition is true, you compare another tag with some other values and make further decision on your action. In this case, you need to nest the second comparison within <code>IF_TRUE</code>/<code>IF_FALSE</code> key in the first operation. In the second operation, you need to specify <code>otherTagString</code> if you work on a tag different from the first operation. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
